import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as a,a as l}from"./app-fd217ae5.js";const p={},e=l(`<h2 id="dio" tabindex="-1"><a class="header-anchor" href="#dio" aria-hidden="true">#</a> Dio</h2><p><code>Dio</code>是一个强大的<code>Dart Http</code>请求库，支持<code>Restful API</code>、<code>FormData</code>、<code>拦截器</code>、<code>请求取消</code>、<code>Cookie管理</code>、<code>文件上传/下载</code>、<code>超时</code>和<code>定义适配器</code>等</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:flutter/material.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:dio/dio.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PageHome</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">StatelessWidget</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">getHttp</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#E5C07B;">Response</span><span style="color:#ABB2BF;"> res;</span></span>
<span class="line"><span style="color:#ABB2BF;">       res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Dio</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://www.xxx?name=002&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;">// res = await Dio().post(&#39;https://xx&#39;,queryParameters:{&#39;name&#39;:002});</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">(res);</span></span>
<span class="line"><span style="color:#ABB2BF;">     } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (e) {</span></span>
<span class="line"><span style="color:#ABB2BF;">     }</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">@override</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">Widget</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BuildContext</span><span style="color:#ABB2BF;"> context) {</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#61AFEF;">getHttp</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Scaffold</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        body</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Center</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">           child</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;首页&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        ),</span></span>
<span class="line"><span style="color:#ABB2BF;">     );</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="伪造请求头" tabindex="-1"><a class="header-anchor" href="#伪造请求头" aria-hidden="true">#</a> 伪造请求头</h3><p>在<code>lib</code>下新建文件夹<code>config</code>，并新建文件<code>httpHeaders.dart</code></p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> httpHeaders </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">&#39;Accept&#39;</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;application/json, text/plain, */*&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;Accept-Encoding&#39;</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;gzip, deflate, br&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;Accept-Language&#39;</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;zh-CN,zh;q=0.9&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;Connection&#39;</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;keep-alive&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;Content-Type&#39;</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;application/json&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;"> ...</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#ABB2BF;">dio.options.headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> httpHeaders;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="futurebuilder-部件" tabindex="-1"><a class="header-anchor" href="#futurebuilder-部件" aria-hidden="true">#</a> FutureBuilder 部件</h2><p><code>Flutter</code>内置部件，用来等待异步请求的，有了这个部件就没必要再用<code>initState</code>了</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;dart:convert&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">_PageHomeState</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">State</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">PageHome</span><span style="color:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">@override</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">Widget</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BuildContext</span><span style="color:#ABB2BF;"> context) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Container</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            child</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Scaffold</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                  appBar</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">AppBar</span><span style="color:#ABB2BF;">(title</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;LifeShop+&#39;</span><span style="color:#ABB2BF;">),),</span></span>
<span class="line"><span style="color:#ABB2BF;">                  body</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">FutureBuilder</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                        future</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">getHomePageContent</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">                        builder</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> (context,snapshot){</span></span>
<span class="line"><span style="color:#ABB2BF;">                           </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;">(snapshot.hasData){</span></span>
<span class="line"><span style="color:#ABB2BF;">                              </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(snapshot.data.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">                            </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Map</span><span style="color:#ABB2BF;">&gt; swiperDataList </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (data[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;slides&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">cast</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">                             </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Map</span><span style="color:#ABB2BF;">&gt; navigatorList </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (data[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;category&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">cast</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">                            </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;">(navigatorList.length </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">                                  navigatorList.</span><span style="color:#61AFEF;">removeRange</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">, navigatorList.length);</span></span>
<span class="line"><span style="color:#ABB2BF;">                             }</span></span>
<span class="line"><span style="color:#ABB2BF;">                           </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Column</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                               children</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&lt;</span><span style="color:#E5C07B;">Widget</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">[</span></span>
<span class="line"><span style="color:#ABB2BF;">                                     </span><span style="color:#E5C07B;">SwiperDiy</span><span style="color:#ABB2BF;">(swiperDataList</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> swiperDataList),</span></span>
<span class="line"><span style="color:#ABB2BF;">                                     </span><span style="color:#E5C07B;">TopNavigator</span><span style="color:#ABB2BF;">(navigatorList</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> navigatorList)</span></span>
<span class="line"><span style="color:#ABB2BF;">                                ],</span></span>
<span class="line"><span style="color:#ABB2BF;">                           );</span></span>
<span class="line"><span style="color:#ABB2BF;">                         } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">                            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Center</span><span style="color:#ABB2BF;">(child</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;加载中...&#39;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">                         }</span></span>
<span class="line"><span style="color:#ABB2BF;">                      },</span></span>
<span class="line"><span style="color:#ABB2BF;">                 )</span></span>
<span class="line"><span style="color:#ABB2BF;">            ),</span></span>
<span class="line"><span style="color:#ABB2BF;">     );</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="provide-状态管理" tabindex="-1"><a class="header-anchor" href="#provide-状态管理" aria-hidden="true">#</a> provide 状态管理</h2><ol><li>创建<code>Provide</code>，这个类似于创建一个<code>state</code>，为了区分，新建文件夹<code>provide</code>，创建<code>counter.dart</code> 混入<code>ChangeNotifier</code>，意思是可以不用管理听众；通过<code>notifyListeners</code>可以通知听众刷新</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:flutter/material.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Counter</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ChangeNotifier</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">int</span><span style="color:#ABB2BF;"> value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">increment</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#ABB2BF;">       value++;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#61AFEF;">notifyListeners</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">   }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将状态放入顶层，<code>ProviderNode</code>封装了<code>InheritWidget</code>，并提供了一个<code>providers</code>容器用于放置状态</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:flutter/material.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:provide/provide.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;./provide/counter.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> counter </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Counter</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> providers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Providers</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">   providers..</span><span style="color:#61AFEF;">provide</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Provider</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Counter</span><span style="color:#ABB2BF;">&gt;.</span><span style="color:#61AFEF;">value</span><span style="color:#ABB2BF;">(counter));</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#61AFEF;">runApp</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">ProviderNode</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        child</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">MyApp</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">        providers</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> providers,</span></span>
<span class="line"><span style="color:#ABB2BF;">      )</span></span>
<span class="line"><span style="color:#ABB2BF;">   );</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>获取、修改状态</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:flutter/material.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:provide/provide.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;../provide/counter.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PageCart</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">StatelessWidget</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">@override</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Widget</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BuildContext</span><span style="color:#ABB2BF;"> context) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Scaffold</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">   body</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Center</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    child</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Column</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">     children</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&lt;</span><span style="color:#E5C07B;">Widget</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">[</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">Provide</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Counter</span><span style="color:#ABB2BF;">&gt;(</span></span>
<span class="line"><span style="color:#ABB2BF;">       builder</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> (context,child,counter){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;\${</span><span style="color:#E06C75;font-style:italic;">counter</span><span style="color:#98C379;">.</span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#98C379;">}&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">       },</span></span>
<span class="line"><span style="color:#ABB2BF;">      ),</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">RaisedButton</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">       onPressed</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> (){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Provide</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">value</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Counter</span><span style="color:#ABB2BF;">&gt;(context).</span><span style="color:#61AFEF;">increment</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">       },</span></span>
<span class="line"><span style="color:#ABB2BF;">       child</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;+1&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">      )</span></span>
<span class="line"><span style="color:#ABB2BF;">     ],</span></span>
<span class="line"><span style="color:#ABB2BF;">    ),</span></span>
<span class="line"><span style="color:#ABB2BF;">   ),</span></span>
<span class="line"><span style="color:#ABB2BF;">  );</span></span>
<span class="line"><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="持久化-shared-perferences" tabindex="-1"><a class="header-anchor" href="#持久化-shared-perferences" aria-hidden="true">#</a> 持久化 shared_perferences</h2><p>用<code>key-value</code>的形式来进行<code>APP</code>客户端的持久化</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:shared_preferences/shared_preferences.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">_incrementCounter</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">SharedPreferences</span><span style="color:#ABB2BF;"> prefs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">SharedPreferences</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getInstance</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">int</span><span style="color:#ABB2BF;"> counter </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (prefs.</span><span style="color:#61AFEF;">getInt</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;counter&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">??</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Pressed $</span><span style="color:#E06C75;font-style:italic;">counter</span><span style="color:#98C379;"> times.&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> prefs.</span><span style="color:#61AFEF;">setInt</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;counter&#39;</span><span style="color:#ABB2BF;">, counter);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// prefs.remove(&#39;counter&#39;);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// prefs.clear();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="系统权限" tabindex="-1"><a class="header-anchor" href="#系统权限" aria-hidden="true">#</a> 系统权限</h2><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:connectivity/connectivity.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:image_picker/image_picker.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:permission_handler/permission_handler.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:saas/utils/dialog.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">SystemOptions</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/// 写入外部存储，检测权限状态，同意则写入 callBack 回调函数</span></span>
<span class="line"><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Future</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">requestPermission</span><span style="color:#ABB2BF;">(context, {callBack}) </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">PermissionStatus</span><span style="color:#ABB2BF;"> permission </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionHandler</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">checkPermissionStatus</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">PermissionGroup</span><span style="color:#ABB2BF;">.storage);</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (permission </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionStatus</span><span style="color:#ABB2BF;">.granted) {</span></span>
<span class="line"><span style="color:#61AFEF;">callBack</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionHandler</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">requestPermissions</span><span style="color:#ABB2BF;">([</span><span style="color:#E5C07B;">PermissionGroup</span><span style="color:#ABB2BF;">.storage]);</span></span>
<span class="line"><span style="color:#E5C07B;">PermissionStatus</span><span style="color:#ABB2BF;"> permission </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionHandler</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">checkPermissionStatus</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">PermissionGroup</span><span style="color:#ABB2BF;">.storage);</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (permission </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionStatus</span><span style="color:#ABB2BF;">.granted) {</span></span>
<span class="line"><span style="color:#61AFEF;">callBack</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">UtilDialog</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">showMessage</span><span style="color:#ABB2BF;">(context, </span><span style="color:#98C379;">&quot;您拒绝读写权限，系统的部分功能将受到影响!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">///网络是否连接 true 网络连接良好</span></span>
<span class="line"><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Future</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">bool</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">isNetConnectivity</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">ConnectivityResult</span><span style="color:#ABB2BF;"> connectivityResult </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Connectivity</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">checkConnectivity</span><span style="color:#ABB2BF;">()); </span><span style="color:#7F848E;font-style:italic;">//无网络状态</span></span>
<span class="line"><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> connectivityResult </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ConnectivityResult</span><span style="color:#ABB2BF;">.none;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">///获取网络类型</span></span>
<span class="line"><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Future</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">ConnectivityResult</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">getConnectivityType</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">ConnectivityResult</span><span style="color:#ABB2BF;"> connectivityResult </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Connectivity</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">checkConnectivity</span><span style="color:#ABB2BF;">()); </span><span style="color:#7F848E;font-style:italic;">//无网络状态</span></span>
<span class="line"><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> connectivityResult;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/// 申请相机或者相册权限</span></span>
<span class="line"><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">requestImagePermission</span><span style="color:#ABB2BF;">(context, </span><span style="color:#E5C07B;">ImageSource</span><span style="color:#ABB2BF;"> source, {callBack}) {</span></span>
<span class="line"><span style="color:#E5C07B;">PermissionGroup</span><span style="color:#ABB2BF;"> requestPermission </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> source </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ImageSource</span><span style="color:#ABB2BF;">.camera</span></span>
<span class="line"><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionGroup</span><span style="color:#ABB2BF;">.camera</span></span>
<span class="line"><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionGroup</span><span style="color:#ABB2BF;">.photos;</span></span>
<span class="line"><span style="color:#E5C07B;">PermissionHandler</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">checkPermissionStatus</span><span style="color:#ABB2BF;">(requestPermission).</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">((values) {</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (values </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionStatus</span><span style="color:#ABB2BF;">.granted) {</span></span>
<span class="line"><span style="color:#61AFEF;">callBack</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">PermissionHandler</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">requestPermissions</span><span style="color:#ABB2BF;">([requestPermission]).</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">((res) {</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (res[requestPermission] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PermissionStatus</span><span style="color:#ABB2BF;">.granted) {</span></span>
<span class="line"><span style="color:#61AFEF;">callBack</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">UtilDialog</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">showMessage</span><span style="color:#ABB2BF;">(context,</span></span>
<span class="line"><span style="color:#98C379;">&#39;您拒绝了使用\${</span><span style="color:#E06C75;font-style:italic;">source</span><span style="color:#98C379;"> == </span><span style="color:#E5C07B;">ImageSource</span><span style="color:#98C379;">.</span><span style="color:#E06C75;font-style:italic;">camera</span><span style="color:#98C379;"> ? &quot;相机&quot; : &quot;照片&quot;}权限，请“设置-隐私-\${</span><span style="color:#E06C75;font-style:italic;">source</span><span style="color:#98C379;"> == </span><span style="color:#E5C07B;">ImageSource</span><span style="color:#98C379;">.</span><span style="color:#E06C75;font-style:italic;">camera</span><span style="color:#98C379;"> ? &quot;相机&quot; : &quot;照片&quot;}”选中项，允许智慧金店访问你的\${</span><span style="color:#E06C75;font-style:italic;">source</span><span style="color:#98C379;"> == </span><span style="color:#E5C07B;">ImageSource</span><span style="color:#98C379;">.</span><span style="color:#E06C75;font-style:italic;">camera</span><span style="color:#98C379;"> ? &quot;相机&quot; : &quot;照片&quot;}&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="websocket" tabindex="-1"><a class="header-anchor" href="#websocket" aria-hidden="true">#</a> websocket</h2><p><code>websocket</code>是一种双工的通行协议，不同于<code>http</code>单工的协议，<code>websocket</code>相当于建立了一条长的<code>TCP</code>链接在服务端和客户端之间，使得服务端和客户端可以实时通行，而不需要通过<code>http</code>轮训的方式来间隔的获取消息</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;package:web_socket_channel/io.dart&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;">IOWebSocketChannel</span><span style="color:#ABB2BF;"> channel;</span></span>
<span class="line"><span style="color:#E5C07B;">Map</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">dynamic</span><span style="color:#ABB2BF;">&gt; headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Map</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">headers[</span><span style="color:#98C379;">&#39;origin&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;https://x.xx.com&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">// 加上一个origin，防止被拦截</span></span>
<span class="line"><span style="color:#ABB2BF;">channel </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">IOWebSocketChannel</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#98C379;">&#39;wss://x.xx.com:443/ws/&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// 可以设置请求头</span></span>
<span class="line"><span style="color:#ABB2BF;">  headers</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> headers</span></span>
<span class="line"><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 监听消息，如果有消息到来，就打印出来</span></span>
<span class="line"><span style="color:#ABB2BF;">channel.stream.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">((message) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">(message);</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">final</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Map</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">dynamic</span><span style="color:#ABB2BF;">&gt; mesData </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(message.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">()); </span><span style="color:#7F848E;font-style:italic;">// 返回的消息是String类型的，可以自己decode一些成为map类型</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">setState</span><span style="color:#ABB2BF;">(() {</span></span>
<span class="line"><span style="color:#ABB2BF;">    text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mesData.text;</span></span>
<span class="line"><span style="color:#ABB2BF;">  });</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现消息的发送和接收同时更新<code>UI</code></p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">channel.slink.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;xxxx&#39;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 将消息加入到通道中，websocket会进行发送操作</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>卸载组件是需要<code>Close</code>掉链接</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">channel.sink.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,28),o=[e];function c(r,B){return n(),a("div",null,o)}const y=s(p,[["render",c],["__file","存储.html.vue"]]);export{y as default};
